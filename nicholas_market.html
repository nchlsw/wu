<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <title>Document</title>
  </head>
  <body class="container">
    <table class="table text-center">
      <thead>
        <tr>
          <th>Product Image</th>
          <th>Product Name</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Quantity in Cart</th>
          <th colspan="2">Cart Actions</th>
        </tr>
      </thead>
      <tbody id="itemData"></tbody>
    </table>
    <center>
      <button onclick="checkout()" class="btn btn-success">Checkout</button>
      <br />
      <br />
      <h3 id="checkoutTimer"></h3>
      <h3 id="checkoutText"></h3>
      <h3 id="payment"></h3>
    </center>

    <script>
      class itemData {
        constructor(image, name, price, stock) {
          (this.name = name),
            (this.price = price),
            (this.stock = stock),
            (this.quantity = 0);
        }
      }
      let newStock = [
        new itemData(
          "https://d29c1z66frfv6c.cloudfront.net/pub/media/catalog/product/large/444b6b8e6d40c8249766694731048fb0b5d22eca_xxl-1.jpg",
          "Premium cotton t-shirt",
          379900,
          10
        ),
        new itemData(
          "https://d29c1z66frfv6c.cloudfront.net/pub/media/catalog/product/large/fc7f1fa35236905d10b51f655c204eaa4c1bc92a_xxl-1.jpg",
          "Silk Blend Polo Shirt",
          549900,
          10
        ),
      ];
      let renderData = () => {
        let htmlResult = "";
        newStock.forEach((val, idx) => {
          htmlResult += `
          <tr style="vertical-align: middle">
          <td>
            <img
              width="100px"
              src= "${val.image}"
            />
          </td>
          <td>${val.name}</td>
          <td>Rp. ${val.price.toLocaleString()}</td>
          <td id="stock">${val.stock}</td>
          <td id="quantity">${val.quantity}</td>
          <td><button onclick="minItem(${idx})"class="btn btn-secondary">-</button></td>
          <td>
            <button onclick="addItem(${idx})" class="btn btn-secondary">+</button>
          </td>
        </tr>`;
        });
        document.getElementById("itemData").innerHTML = htmlResult;
      };
      renderData();

      const addItem = (index) => {
        console.log(newStock);
        if (newStock[index].quantity < newStock[index].stock) {
          newStock[index].quantity++;
        } else {
          alert("Stock Habis");
        }
        renderData();
        return;
      };

      const minItem = (index) => {
        if (newStock[index].quantity > 0) {
          newStock[index].quantity--;
        }
        renderData();
        return;
      };

      let totalCheckout = 0;
      const checkout = () => {
        for (let i = 0; i < newStock.length; i++) {
          totalCheckout += newStock[i].price * newStock[i].quantity;
          const newItemStock = newStock[i].stock - newStock[i].quantity;
          newStock[i].stock = newItemStock;
          newStock[i].quantity = 0;
        }

        document.getElementById("checkoutTimer").innerHTML = `

        <h3 id="timer"><span id="minutes"></span>:<span id="seconds"></span></h3>`;
        document.getElementById(
          "checkoutText"
        ).innerHTML = `Total belanjaan anda : Rp. ${totalCheckout.toLocaleString()}`;
        document.getElementById(
          "payment"
        ).innerHTML = `Masukkan nominal pembayaran anda : <input type="text" id="paymentAmount"> <button onclick="payment()">Bayar</button>`;
        let seconds = 05;
        let minutes = 00;
        let timer;
        timer = setInterval(() => {
          seconds = parseInt(seconds);
          minutes = parseInt(minutes);

          seconds -= 1;

          if (seconds < 10) {
            seconds = "0" + seconds;
          }
          document.getElementById("seconds").innerHTML = seconds;

          if (seconds == 00) {
            minutes--;
            seconds = 59;
          }

          if (minutes < 10) {
            minutes = "0" + minutes;
          }

          document.getElementById("seconds").innerHTML = seconds;
          document.getElementById("minutes").innerHTML = minutes;
        }, 1000);
      };

      const payment = () => {
        const paymentValue = document.getElementById("paymentAmount").value;
        if (paymentValue == totalCheckout) {
          alert("Pembayaran Berhasil");
        } else if (paymentValue < totalCheckout) {
          let paymentDifference = totalCheckout - paymentValue;
          alert(
            `Pembayaran anda kurang: Rp. ${paymentDifference.toLocaleString()}`
          );
          return;
        } else if (paymentValue > totalCheckout) {
          let changeValue = paymentValue - totalCheckout;
          alert(`Kembalian anda sebesar: Rp.${changeValue.toLocaleString()}`);
        }
        renderData();
      };
    </script>
  </body>
</html>
